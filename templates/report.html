{% extends "base.html" %}
{% block content %}
<h3 class="mb-3">Full Report</h3>

{% if has_data %}
<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="card shadow-sm h-100"><div class="card-body">
      <div class="text-muted">Total Entries</div>
      <div class="display-6">{{ overall.count }}</div>
    </div></div>
  </div>
  <div class="col-md-4">
    <div class="card shadow-sm h-100"><div class="card-body">
      <div class="text-muted">Average BMI</div>
      <div class="display-6">{{ '%.2f'|format(overall.avg_bmi) }}</div>
    </div></div>
  </div>
  <div class="col-md-4">
    <a class="btn btn-outline-dark w-100 h-100 d-flex align-items-center justify-content-center" href="{{ url_for('export_csv') }}">Export CSV</a>
  </div>
</div>

<div class="row g-3">
  <div class="col-md-6">
    <div class="card shadow-sm h-100"><div class="card-body">
      <h5 class="card-title">Average BMI by Sex</h5>
      <canvas id="bySex" height="120"></canvas>
    </div></div>
  </div>
  <div class="col-md-6">
    <div class="card shadow-sm h-100"><div class="card-body">
      <h5 class="card-title">Average BMI by Age Band</h5>
      <canvas id="byBand" height="120"></canvas>
    </div></div>
  </div>
  <div class="col-md-12">
    <div class="card shadow-sm h-100"><div class="card-body">
      <h5 class="card-title">Category Distribution</h5>
      <canvas id="byCat" height="120"></canvas>
    </div></div>
  </div>
</div>

<script>
const chartSexLabels = {{ chart_sex_labels_json|safe }};
const chartSexValues = {{ chart_sex_values_json|safe }};
const chartBandLabels = {{ chart_band_labels_json|safe }};
const chartBandValues = {{ chart_band_values_json|safe }};
const chartCatLabels = {{ chart_cat_labels_json|safe }};
const chartCatValues = {{ chart_cat_values_json|safe }};

new Chart(document.getElementById('bySex'), {
  type: 'bar',
  data: {
    labels: chartSexLabels,
    datasets: [{
      label: 'BMI',
      data: chartSexValues,
      backgroundColor: 'rgba(54, 162, 235, 0.5)'
    }]
  }
});

new Chart(document.getElementById('byBand'), {
  type: 'bar',
  data: {
    labels: chartBandLabels,
    datasets: [{
      label: 'BMI',
      data: chartBandValues,
      backgroundColor: 'rgba(255, 99, 132, 0.5)'
    }]
  }
});

new Chart(document.getElementById('byCat'), {
  type: 'pie',
  data: {
    labels: chartCatLabels,
    datasets: [{
      data: chartCatValues,
      backgroundColor: [
        'rgba(255, 99, 132, 0.5)',
        'rgba(54, 162, 235, 0.5)',
        'rgba(255, 206, 86, 0.5)',
        'rgba(75, 192, 192, 0.5)',
        'rgba(153, 102, 255, 0.5)',
        'rgba(255, 159, 64, 0.5)'
      ]
    }]
  }
});
</script>
{% else %}
<div class="alert alert-info">No data yet. Add a few entries first.</div>
{% endif %}
{% endblock %}
